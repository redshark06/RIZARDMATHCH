<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LizardMatch - 최종 확인</title>
    <link rel="stylesheet" href="https://unpkg.com/@phosphor-icons/web@2.1.1/src/regular/style.css">
    <link rel="stylesheet" href="https://unpkg.com/@phosphor-icons/web@2.1.1/src/fill/style.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body class="survey-ui">
    <header class="main-header">
        <div class="header-container">
            <a class="logo" href="index.html" aria-label="ReptiMatch AI 홈으로">
                <i class="ph-fill ph-leaf logo-icon" aria-hidden="true"></i>
                <span class="logo-text">ReptiMatch AI</span>
            </a>
            <nav class="main-nav">
                <a href="index.html" class="nav-link">홈</a>
                <a href="survey_page1.html" class="nav-link active">매칭 찾기</a>
                <a href="dex.html" class="nav-link">도감</a>
            </nav>
            <a href="survey_page1.html" class="btn-header">테스트 시작하기</a>
        </div>
    </header>

    <main class="survey-shell">
        <div class="survey-progress">
            <span class="progress-text">질문 4 / 4</span>
            <div class="progress-bar"><div class="progress-fill"></div></div>
            <span class="progress-percent">100%</span>
        </div>

        <section class="survey-card">
            <div class="review-container">
                <h2>설문 내용 확인</h2>
                <div id="reviewContent" class="review-content">
                    <!-- 동적으로 생성됨 -->
                </div>
            </div>

            <div class="form-actions">
                <button type="button" id="prevBtn" class="btn btn-secondary">이전</button>
                <button type="button" id="submitBtn" class="btn btn-primary">추천 받기</button>
            </div>
        </section>
    </main>

    <!-- 추천 계산 중 로딩 오버레이 (설문 제출 후 표시) -->
    <div id="analysisOverlay" class="analysis-overlay" style="display:none;" aria-live="polite" aria-busy="true">
        <div class="analysis-box" role="status" aria-label="추천 결과를 계산하는 중입니다">
            <div class="analysis-spinner">
                <div class="analysis-ring" aria-hidden="true"></div>
                <i class="ph-fill ph-leaf analysis-leaf" aria-hidden="true"></i>
            </div>
            <div class="analysis-title">당신과의 궁합을 분석 중입니다...</div>
            <div class="analysis-sub">150종 이상의 파충류 데이터와 대조하고 있습니다.</div>
        </div>
    </div>

    <script src="app.js"></script>
    <script src="survey_navigation.js"></script>
    <script src="form_utils.js"></script>
    <script>
        // 페이지 로드 시 저장된 데이터 복원 및 확인 내용 표시
        document.addEventListener('DOMContentLoaded', () => {
            restoreCurrentPageData();
            updateProgressIndicator();
            displayReview();
        });

        // 이전 버튼
        document.getElementById('prevBtn').addEventListener('click', () => {
            goToPreviousPage();
        });

        // 제출 버튼
        document.getElementById('submitBtn').addEventListener('click', () => {
            handleFinalSubmit();
        });

        function displayReview() {
            const allData = collectAllPageData();
            const reviewContent = document.getElementById('reviewContent');
            
            let html = '<div class="review-section">';
            html += '<h3>선택한 종류</h3>';
            html += '<p>' + (allData.preferences.종류 ? allData.preferences.종류.join(', ') : '없음') + '</p>';
            html += '</div>';

            // 각 질문별로 확인 내용 표시
            const questions = [
                { key: '사육_난이도_5단계', label: '사육 난이도' },
                { key: '초기비용_등급_5단계_max', label: '초기 비용' },
                { key: '사육장_사이즈_3단계_max', label: '사육장 크기' },
                { key: '활동패턴', label: '활동 패턴' },
                { key: '먹이빈도_등급_prefer', label: '먹이 급여 부담' },
                { key: '핸들링적합도_5단계_prefer', label: '핸들링 적합도' },
                { key: '관상용_애완용', label: '사육 목적' },
                { key: '식성타입', label: '식성 타입' },
                { key: '외형태그', label: '외형 태그' }
            ];

            questions.forEach(q => {
                const value = allData.preferences[q.key];
                if (value !== undefined && value !== null && value !== '') {
                    html += `<div class="review-section">`;
                    html += `<h3>${q.label}</h3>`;
                    html += `<p>${Array.isArray(value) ? value.join(', ') : value}</p>`;
                    html += `</div>`;
                }
            });

            reviewContent.innerHTML = html;
        }
    </script>
</body>
</html>

